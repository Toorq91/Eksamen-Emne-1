<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="sudokuGame.css">
    <title>2x2 Sudoku</title>
</head>

<body>
    <div id="app" style="user-select: none;"></div>

    <script>
        // start posisjon for brettet
        const currentBoard = [1, 2, ' ', 3, 4, ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ']
        let selectedSquareIndex = -1;
        let finished = 0;
        let youWonMessage = document.createElement("h1");

        updateView();

        function updateView() {
            let boardstyle = '';

            if (hasDuplicatesInRows(currentBoard) ||
                hasDuplicatesInRows(getColumns(currentBoard)) ||
                hasDuplicatesInRows(getSquares(currentBoard))) {
                boardstyle = 'pink';
            } else if (fullyFilled(currentBoard) && !finished) {
                finished = 1;
                boardstyle = 'green';

                youWonMessage.innerHTML = "Alt er riktig! Du vant üòÅ";
                youWonMessage.id = "youWonMessage";
                document.body.appendChild(youWonMessage);
                selectedSquareIndex = -1;
            } else {
                boardstyle = 'board';
            }

            document.getElementById('app').innerHTML = /*HTML*/`
            <div class="${boardstyle}">${createBoard()}</div>
                <button onclick="button1()" class="buttonOne">1</button>
                <button onclick="button2()" class="button234">2</button>
                <button onclick="button3()" class="button234">3</button>
                <button onclick="button4()" class="button234">4</button><br/>
                <button class="reset" onclick="resetButton()">Reset</button>
                <h1 id="youWonMessage" style="display: ${finished ? 'block' : 'none'};"></h1>
            `;
        }

        function button1() {
            if (selectedSquareIndex !== -1) {
                currentBoard[selectedSquareIndex] = 1;
                updateView();
            }
        }

        function button2() {
            if (selectedSquareIndex !== -1) {
                currentBoard[selectedSquareIndex] = 2;
                updateView();
            }
        }

        function button3() {
            if (selectedSquareIndex !== -1) {
                currentBoard[selectedSquareIndex] = 3;
                updateView();
            }
        }

        function button4() {
            if (selectedSquareIndex !== -1) {
                currentBoard[selectedSquareIndex] = 4;
                updateView();
            }
        }

        // snart ferdig :)
        function resetButton() {
            const starterBoard = [1, 2, ' ', 3, 4, ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ']
            currentBoard.splice(0, currentBoard.length, ...starterBoard);
            selectedSquareIndex = -1;
            finished = 0;
            youWonMessage.innerHTML = '';
            updateView();
        }

        function createBoard() {
            let html = '';

            for (let index = 0; index < currentBoard.length; index++) {
                const squareValue = currentBoard[index];
                const isSelected = index === selectedSquareIndex ? 'selected' : '';
                html += `<div class="square ${isSelected}" onclick="selectSquare(${index})">${squareValue}</div>`;
            }

            return html;
        }

        function selectSquare(index) {
            if (!finished) {
                selectedSquareIndex = index;
                updateView();
            }
        }

        function fullyFilled(board) {
            const numberOfnumbers = board.filter(element => typeof element === 'number' && !isNaN(element)).length;
            return numberOfnumbers === 16;
        }

        function hasDuplicatesInRows(board) {
            for (let row = 0; row < 4; row++) {
                const seen = {};
                const rowValues = board.slice(row * 4, (row + 1) * 4);

                for (const num of rowValues) {
                    if (num !== ' ' && seen[num]) {
                        return true;
                    }
                    seen[num] = true;
                }
            }
            return false;
        }

        function getColumns(board) {
            const columns = [];

            for (let col = 0; col < 4; col++) {
                columns.push([]);
                for (let row = 0; row < 4; row++) {
                    columns[col].push(board[row * 4 + col]);
                }
            }
            return columns.flat();
        }

        function getSquare(board, startRow, startCol) {
            const square = [];

            for (let row = startRow; row < startRow + 2; row++) {
                for (let col = startCol; col < startCol + 2; col++) {
                    square.push(board[row * 4 + col]);
                }
            }
            return square;
        }

        function getSquares(board) {
            const squares = [];

            for (let startRow = 0; startRow < 4; startRow += 2) {
                for (let startCol = 0; startCol < 4; startCol += 2) {
                    squares.push(getSquare(board, startRow, startCol));
                }
            }
            return squares.flat();
        }

    </script>
</body>

</html>